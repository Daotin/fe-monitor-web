import{_ as I,u as V,T as x}from"./components-CSIQ8o7O.js";import{d as N,e as z,f as U}from"./index-DQjgSYRf.js";import{a as F,f as B}from"./utils-PfC8a2su.js";import{d as L,c as $,h as P,o as d,w as o,e as r,b as g,f as e,r as i,j as R,t as h,P as S,F as A,g as Y,k as b,m as H,l as E,L as O,p as j}from"./vue-vendor-DZbjFZat.js";import{a as D}from"./element-plus-CUIuS-xu.js";import"./store-vendor-BzeCd7_m.js";import"./utils-vendor-t--hEgTQ.js";import"./lodash-S0Y0Up6J.js";import"./vendor-OHnlOk1r.js";const q={class:"card-header"},G={class:"title"},J={key:0,class:"loading-container"},K={key:1,class:"metrics-container"},Q={class:"metric-item"},W={class:"metric-item"},X=L({__name:"PerformanceMetricCard",props:{title:{},avgValue:{},p75Value:{},icon:{default:"Timer"},color:{default:"#409EFF"},loading:{type:Boolean,default:!1},threshold:{default:()=>({good:1e3,needsImprovement:2500})}},setup(T){const a=T,u=t=>F(t),y=t=>t<=a.threshold.good?"#67C23A":t<=a.threshold.needsImprovement?"#E6A23C":"#F56C6C",f=$(()=>y(a.avgValue)),n=$(()=>y(a.p75Value));return(t,v)=>{const m=i("el-icon"),c=i("el-skeleton"),p=i("el-card");return d(),P(p,{class:"metric-card","body-style":{padding:"15px"}},{default:o(()=>[r("div",q,[r("div",G,[e(m,{size:20,color:t.color},{default:o(()=>[(d(),P(R(t.icon)))]),_:1},8,["color"]),r("span",null,h(t.title),1)])]),t.loading?(d(),g("div",J,[e(c,{animated:"",rows:2})])):(d(),g("div",K,[r("div",Q,[v[0]||(v[0]=r("div",{class:"metric-label"},"平均值",-1)),r("div",{class:"metric-value",style:S({color:f.value})},h(u(t.avgValue)),5)]),r("div",W,[v[1]||(v[1]=r("div",{class:"metric-label"},"P75",-1)),r("div",{class:"metric-value",style:S({color:n.value})},h(u(t.p75Value)),5)])]))]),_:1})}}}),M=I(X,[["__scopeId","data-v-a000fcd3"]]),Z={class:"card-header"},ee={key:0,class:"loading-container"},te={key:1,class:"empty-container"},oe={key:2,class:"pages-list"},ae={class:"list-header"},se={class:"value-header"},le=["title"],ne=L({__name:"SlowPagesList",props:{data:{default:()=>[]},loading:{type:Boolean,default:!1},metric:{default:"lcp"}},emits:["update:metric"],setup(T,{emit:a}){const u=T,y=a,f={lcp:"LCP (最大内容绘制)",fcp:"FCP (首次内容绘制)"},n=$(()=>f[u.metric]||u.metric.toUpperCase()),t=(m,c)=>{const p={lcp:{good:2500,needsImprovement:4e3},fcp:{good:1e3,needsImprovement:2500}},_=p[c]||p.lcp;return m<=_.good?"#67C23A":m<=_.needsImprovement?"#E6A23C":"#F56C6C"},v=m=>m.length>40?m.substring(0,40)+"...":m;return(m,c)=>{const p=i("el-radio-button"),_=i("el-radio-group"),k=i("el-skeleton"),s=i("el-empty"),C=i("el-card");return d(),P(C,{class:"slow-pages-card"},{header:o(()=>[r("div",Z,[c[3]||(c[3]=r("span",{class:"title"},"Top 5 慢页面",-1)),e(_,{"model-value":u.metric,"onUpdate:modelValue":c[0]||(c[0]=l=>y("update:metric",l)),size:"small"},{default:o(()=>[e(p,{label:"lcp"},{default:o(()=>c[1]||(c[1]=[b("LCP")])),_:1}),e(p,{label:"fcp"},{default:o(()=>c[2]||(c[2]=[b("FCP")])),_:1})]),_:1},8,["model-value"])])]),default:o(()=>[m.loading?(d(),g("div",ee,[e(k,{animated:"",rows:5})])):m.data.length===0?(d(),g("div",te,[e(s,{description:"暂无数据","image-size":80})])):(d(),g("div",oe,[r("div",ae,[c[4]||(c[4]=r("span",{class:"url-header"},"页面URL",-1)),r("span",se,h(n.value),1)]),(d(!0),g(A,null,Y(m.data,(l,w)=>(d(),g("div",{key:w,class:"page-item"},[r("div",{class:"page-url",title:l.url},h(v(l.url)),9,le),r("div",{class:"page-value",style:S({color:t(l.value,u.metric)})},h(H(F)(l.value)),5)]))),128))]))]),_:1})}}}),re=I(ne,[["__scopeId","data-v-430de9b5"]]),ce={key:0,class:"loading-container"},ie={key:1,class:"empty-container"},de={class:"url-text"},me={key:0},ue={key:1},pe=L({__name:"ResourceErrorsList",props:{data:{default:()=>[]},loading:{type:Boolean,default:!1}},setup(T){const a=n=>n.length>40?n.substring(0,40)+"...":n,u=n=>B(new Date(n),"YYYY-MM-DD HH:mm:ss"),y=n=>({script:"Document",link:"Link",img:"Picture",video:"VideoPlay",audio:"Headset",iframe:"Monitor"})[n.toLowerCase()]||"Document",f=n=>n.includes("404")?"danger":n.includes("ERR_CONNECTION")||n.includes("TIMEOUT")?"warning":(n.includes("CERT"),"info");return(n,t)=>{const v=i("el-skeleton"),m=i("el-empty"),c=i("el-icon"),p=i("el-tooltip"),_=i("el-table-column"),k=i("el-tag"),s=i("el-table"),C=i("el-card");return d(),P(C,{class:"resource-errors-card"},{header:o(()=>t[0]||(t[0]=[r("div",{class:"card-header"},[r("span",{class:"title"},"资源加载错误")],-1)])),default:o(()=>[n.loading?(d(),g("div",ce,[e(v,{animated:"",rows:5})])):n.data.length===0?(d(),g("div",ie,[e(m,{description:"暂无数据","image-size":80})])):(d(),P(s,{key:2,data:n.data,style:{width:"100%"},size:"large"},{default:o(()=>[e(_,{label:"资源类型",width:"80"},{default:o(({row:l})=>[e(p,{content:l.tagName,placement:"top"},{default:o(()=>[e(c,{size:20},{default:o(()=>[(d(),P(R(y(l.tagName))))]),_:2},1024)]),_:2},1032,["content"])]),_:1}),e(_,{label:"资源URL","min-width":"200"},{default:o(({row:l})=>[e(p,{content:l.url,placement:"top","show-after":500},{default:o(()=>[r("span",de,h(a(l.url)),1)]),_:2},1032,["content"])]),_:1}),e(_,{label:"错误类型","min-width":"180"},{default:o(({row:l})=>[e(k,{type:f(l.type),size:"small"},{default:o(()=>[b(h(l.type),1)]),_:2},1032,["type"])]),_:1}),e(_,{label:"状态码",width:"100",align:"center"},{default:o(({row:l})=>[l.status?(d(),g("span",me,h(l.status),1)):(d(),g("span",ue,"-"))]),_:1}),e(_,{label:"发生时间","min-width":"180"},{default:o(({row:l})=>[b(h(u(l.timestamp)),1)]),_:1})]),_:1},8,["data"]))]),_:1})}}}),_e=I(pe,[["__scopeId","data-v-7f02431c"]]),ge={class:"performance-container"},fe=L({__name:"index",setup(T){const a=V(),u=E({lcp:{avg:0,p75:0},fcp:{avg:0,p75:0}}),y=E([]),f=E("lcp"),n=E([]),t=E({performance:!1,slowPages:!1,resourceErrors:!1}),v=async()=>{t.value.performance=!0,console.log("加载性能指标数据..."),console.log("应用ID:",a.appId),console.log("开始时间:",a.startTime),console.log("结束时间:",a.endTime);try{const s=await N(a.appId,a.startTime,a.endTime);console.log("性能指标数据:",s),u.value=s}catch(s){console.error("加载性能指标数据失败:",s),D.error("加载性能指标数据失败")}finally{t.value.performance=!1}},m=async()=>{t.value.slowPages=!0,console.log("加载慢页面数据..."),console.log("指标类型:",f.value);try{const s=await z(a.appId,a.startTime,a.endTime,f.value,5);console.log("慢页面数据:",s),y.value=s}catch(s){console.error("加载慢页面数据失败:",s),D.error("加载慢页面数据失败")}finally{t.value.slowPages=!1}},c=async()=>{t.value.resourceErrors=!0,console.log("加载资源错误数据...");try{const s=await U(a.appId,a.startTime,a.endTime,10);console.log("资源错误数据:",s),n.value=s}catch(s){console.error("加载资源错误数据失败:",s),D.error("加载资源错误数据失败")}finally{t.value.resourceErrors=!1}},p=()=>{v(),m(),c()},_=()=>{console.log("时间范围变化:",a.timeRange),console.log("新的开始时间:",a.startTime),console.log("新的结束时间:",a.endTime),p()},k=s=>{console.log("指标类型变化:",s),f.value=s,m()};return O(()=>a.appId,(s,C)=>{s!==C&&(console.log("应用ID变化:",s),p())}),j(()=>{console.log("Performance页面已挂载"),p()}),(s,C)=>{const l=i("el-row"),w=i("el-col");return d(),g("div",ge,[C[0]||(C[0]=r("div",{class:"performance-header"},[r("h2",{class:"page-title"},"性能概览"),r("p",{class:"page-description"},"查看和分析应用的核心性能指标")],-1)),e(l,{class:"time-filter"},{default:o(()=>[e(x,{onChange:_})]),_:1}),e(l,{gutter:20,class:"metric-cards"},{default:o(()=>[e(w,{xs:24,sm:12},{default:o(()=>[e(M,{title:"LCP (最大内容绘制)","avg-value":u.value.lcp.avg,"p75-value":u.value.lcp.p75,icon:"Timer",color:"#E6A23C",loading:t.value.performance,threshold:{good:2500,needsImprovement:4e3}},null,8,["avg-value","p75-value","loading"])]),_:1}),e(w,{xs:24,sm:12},{default:o(()=>[e(M,{title:"FCP (首次内容绘制)","avg-value":u.value.fcp.avg,"p75-value":u.value.fcp.p75,icon:"PictureFilled",color:"#409EFF",loading:t.value.performance,threshold:{good:1e3,needsImprovement:2500}},null,8,["avg-value","p75-value","loading"])]),_:1})]),_:1}),e(l,{gutter:20,class:"data-lists"},{default:o(()=>[e(w,{xs:24,lg:12},{default:o(()=>[e(re,{data:y.value,loading:t.value.slowPages,metric:f.value,"onUpdate:metric":k},null,8,["data","loading","metric"])]),_:1}),e(w,{xs:24,lg:12},{default:o(()=>[e(_e,{data:n.value,loading:t.value.resourceErrors},null,8,["data","loading"])]),_:1})]),_:1})])}}}),be=I(fe,[["__scopeId","data-v-89ea9f36"]]);export{be as default};
