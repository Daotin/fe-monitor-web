{"version":3,"file":"index--mPXAYBe.js","sources":["../../../src/components/sourcemap/SourceMapUploader.vue","../../../src/components/sourcemap/SourceMapList.vue","../../../src/views/sourcemap/index.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { ref } from 'vue'\nimport { ElMessage } from 'element-plus'\nimport type { UploadFile, UploadFiles, UploadInstance } from 'element-plus'\nimport { uploadSourceMap } from '../../api'\n\ninterface Props {\n\tappId: string\n\tonSuccess?: () => void\n}\n\nconst props = defineProps<Props>()\n\n// 上传组件引用\nconst uploadRef = ref<UploadInstance>()\n\n// 版本号\nconst version = ref('')\n\n// 上传状态\nconst uploading = ref(false)\n\n// 文件列表\nconst fileList = ref<UploadFile[]>([])\n\n// 上传前验证\nconst beforeUpload = (file: File) => {\n\t// 验证文件类型\n\tif (!file.name.endsWith('.map') && !file.name.endsWith('.js.map')) {\n\t\tElMessage.error('请上传.map或.js.map后缀的SourceMap文件')\n\t\treturn false\n\t}\n\n\t// 验证文件大小 (限制为20MB)\n\tconst maxSize = 20 * 1024 * 1024\n\tif (file.size > maxSize) {\n\t\tElMessage.error('文件大小不能超过20MB')\n\t\treturn false\n\t}\n\n\t// 验证版本号\n\tif (!version.value) {\n\t\tElMessage.warning('请输入版本号')\n\t\treturn false\n\t}\n\n\treturn true\n}\n\n// 自定义上传方法\nconst customUpload = async (file: File) => {\n\tif (!props.appId) {\n\t\tElMessage.warning('请先选择应用')\n\t\treturn\n\t}\n\n\ttry {\n\t\tuploading.value = true\n\t\tconsole.log('上传文件:', file.name)\n\t\tconsole.log('应用ID:', props.appId)\n\t\tconsole.log('版本号:', version.value)\n\n\t\tconst response = await uploadSourceMap(props.appId, file, version.value)\n\t\tconsole.log('上传成功:', response)\n\n\t\tElMessage.success(`文件 ${file.name} 上传成功`)\n\n\t\t// 清空文件列表和版本号\n\t\tfileList.value = []\n\t\tversion.value = ''\n\n\t\t// 调用成功回调\n\t\tif (props.onSuccess) {\n\t\t\tprops.onSuccess()\n\t\t}\n\t} catch (error) {\n\t\tconsole.error('上传失败:', error)\n\t\tElMessage.error('文件上传失败，请重试')\n\t} finally {\n\t\tuploading.value = false\n\t}\n}\n\n// 处理文件选择变化\nconst handleFileChange = (uploadFile: UploadFile, uploadFiles: UploadFiles) => {\n\tconsole.log('文件变化:', uploadFile.name)\n\tfileList.value = uploadFiles\n}\n\n// 处理文件移除\nconst handleFileRemove = () => {\n\tfileList.value = []\n}\n\n// 提交上传\nconst submitUpload = () => {\n\tif (fileList.value.length === 0) {\n\t\tElMessage.warning('请先选择文件')\n\t\treturn\n\t}\n\n\tif (!version.value) {\n\t\tElMessage.warning('请输入版本号')\n\t\treturn\n\t}\n\n\tconst file = fileList.value[0].raw as File\n\tcustomUpload(file)\n}\n</script>\n\n<template>\n\t<el-card class=\"sourcemap-uploader\">\n\t\t<template #header>\n\t\t\t<div class=\"card-header\">\n\t\t\t\t<span class=\"title\">上传SourceMap文件</span>\n\t\t\t</div>\n\t\t</template>\n\n\t\t<div class=\"upload-form\">\n\t\t\t<el-form label-position=\"top\">\n\t\t\t\t<el-form-item label=\"应用ID\">\n\t\t\t\t\t<el-input :model-value=\"props.appId\" disabled placeholder=\"应用ID\" />\n\t\t\t\t</el-form-item>\n\n\t\t\t\t<el-form-item label=\"版本号\">\n\t\t\t\t\t<el-input v-model=\"version\" placeholder=\"请输入版本号，例如: 1.0.0\" :disabled=\"uploading\" />\n\t\t\t\t</el-form-item>\n\n\t\t\t\t<el-form-item label=\"SourceMap文件\">\n\t\t\t\t\t<el-upload\n\t\t\t\t\t\tref=\"uploadRef\"\n\t\t\t\t\t\tclass=\"sourcemap-upload\"\n\t\t\t\t\t\taction=\"#\"\n\t\t\t\t\t\t:auto-upload=\"false\"\n\t\t\t\t\t\t:limit=\"1\"\n\t\t\t\t\t\t:file-list=\"fileList\"\n\t\t\t\t\t\t:before-upload=\"beforeUpload\"\n\t\t\t\t\t\t:on-change=\"handleFileChange\"\n\t\t\t\t\t\t:on-remove=\"handleFileRemove\"\n\t\t\t\t\t\t:disabled=\"uploading\">\n\t\t\t\t\t\t<template #trigger>\n\t\t\t\t\t\t\t<el-button type=\"primary\" :disabled=\"uploading\">选择文件</el-button>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template #tip>\n\t\t\t\t\t\t\t<div class=\"el-upload__tip\">请上传.map或.js.map后缀的SourceMap文件，大小不超过20MB</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</el-upload>\n\t\t\t\t</el-form-item>\n\n\t\t\t\t<el-form-item>\n\t\t\t\t\t<el-button\n\t\t\t\t\t\ttype=\"success\"\n\t\t\t\t\t\t@click=\"submitUpload\"\n\t\t\t\t\t\t:loading=\"uploading\"\n\t\t\t\t\t\t:disabled=\"fileList.length === 0 || !version\">\n\t\t\t\t\t\t{{ uploading ? '上传中...' : '上传文件' }}\n\t\t\t\t\t</el-button>\n\t\t\t\t</el-form-item>\n\t\t\t</el-form>\n\t\t</div>\n\t</el-card>\n</template>\n\n<style scoped lang=\"less\">\n.sourcemap-uploader {\n\tmargin-bottom: 20px;\n\n\t.card-header {\n\t\t.title {\n\t\t\tfont-size: 16px;\n\t\t\tfont-weight: 600;\n\t\t}\n\t}\n\n\t.upload-form {\n\t\t.sourcemap-upload {\n\t\t\twidth: 100%;\n\t\t}\n\n\t\t.el-upload__tip {\n\t\t\tcolor: #909399;\n\t\t\tfont-size: 12px;\n\t\t\tmargin-top: 5px;\n\t\t}\n\t}\n}\n</style>\n","<script setup lang=\"ts\">\nimport { ref, computed } from 'vue'\nimport { ElMessageBox, ElMessage } from 'element-plus'\nimport { deleteSourceMap } from '../../api'\nimport type { SourceMapFile } from '../../api'\n\ninterface Props {\n  data: SourceMapFile[]\n  loading: boolean\n  onDelete?: () => void\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  data: () => [],\n  loading: false\n})\n\n// 删除中的文件ID\nconst deletingId = ref<string | null>(null)\n\n// 格式化文件大小\nconst formatFileSize = (size: number): string => {\n  if (size < 1024) {\n    return size + ' B'\n  } else if (size < 1024 * 1024) {\n    return (size / 1024).toFixed(2) + ' KB'\n  } else if (size < 1024 * 1024 * 1024) {\n    return (size / (1024 * 1024)).toFixed(2) + ' MB'\n  } else {\n    return (size / (1024 * 1024 * 1024)).toFixed(2) + ' GB'\n  }\n}\n\n// 处理删除文件\nconst handleDelete = async (file: SourceMapFile) => {\n  try {\n    await ElMessageBox.confirm(\n      `确定要删除文件 ${file.fileName} 吗？`,\n      '删除确认',\n      {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }\n    )\n    \n    deletingId.value = file.id\n    console.log('删除文件:', file.id, file.fileName)\n    \n    const response = await deleteSourceMap(file.id)\n    console.log('删除结果:', response)\n    \n    if (response.success) {\n      ElMessage.success('文件删除成功')\n      \n      // 调用删除成功回调\n      if (props.onDelete) {\n        props.onDelete()\n      }\n    } else {\n      ElMessage.error('文件删除失败')\n    }\n  } catch (error) {\n    if (error !== 'cancel') {\n      console.error('删除文件失败:', error)\n      ElMessage.error('删除文件失败，请重试')\n    }\n  } finally {\n    deletingId.value = null\n  }\n}\n\n// 获取状态标签类型\nconst getStatusType = (status: string): '' | 'success' | 'warning' | 'info' | 'danger' => {\n  switch (status) {\n    case 'active':\n      return 'success'\n    case 'inactive':\n      return 'info'\n    default:\n      return ''\n  }\n}\n\n// 获取状态标签文本\nconst getStatusText = (status: string): string => {\n  switch (status) {\n    case 'active':\n      return '活跃'\n    case 'inactive':\n      return '未使用'\n    default:\n      return status\n  }\n}\n</script>\n\n<template>\n  <el-card class=\"sourcemap-list\">\n    <template #header>\n      <div class=\"card-header\">\n        <span class=\"title\">已上传的SourceMap文件</span>\n      </div>\n    </template>\n    \n    <div v-if=\"loading\" class=\"loading-container\">\n      <el-skeleton animated :rows=\"5\" />\n    </div>\n    \n    <div v-else-if=\"data.length === 0\" class=\"empty-container\">\n      <el-empty description=\"暂无上传的SourceMap文件\" :image-size=\"80\" />\n    </div>\n    \n    <el-table v-else :data=\"data\" style=\"width: 100%\" size=\"large\">\n      <el-table-column label=\"文件名\" min-width=\"200\" show-overflow-tooltip>\n        <template #default=\"{ row }\">\n          <div class=\"file-name\">\n            <el-icon><Document /></el-icon>\n            <span>{{ row.fileName }}</span>\n          </div>\n        </template>\n      </el-table-column>\n      \n      <el-table-column label=\"原始文件\" min-width=\"180\" show-overflow-tooltip>\n        <template #default=\"{ row }\">\n          {{ row.originalFileName }}\n        </template>\n      </el-table-column>\n      \n      <el-table-column label=\"版本\" width=\"100\">\n        <template #default=\"{ row }\">\n          {{ row.version }}\n        </template>\n      </el-table-column>\n      \n      <el-table-column label=\"大小\" width=\"100\">\n        <template #default=\"{ row }\">\n          {{ formatFileSize(row.size) }}\n        </template>\n      </el-table-column>\n      \n      <el-table-column label=\"状态\" width=\"100\">\n        <template #default=\"{ row }\">\n          <el-tag :type=\"getStatusType(row.status)\" size=\"small\">\n            {{ getStatusText(row.status) }}\n          </el-tag>\n        </template>\n      </el-table-column>\n      \n      <el-table-column label=\"上传时间\" min-width=\"180\">\n        <template #default=\"{ row }\">\n          {{ row.uploadTime }}\n        </template>\n      </el-table-column>\n      \n      <el-table-column label=\"操作\" width=\"100\" fixed=\"right\">\n        <template #default=\"{ row }\">\n          <el-button\n            type=\"danger\"\n            size=\"small\"\n            :loading=\"deletingId === row.id\"\n            @click=\"handleDelete(row)\">\n            删除\n          </el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n  </el-card>\n</template>\n\n<style scoped lang=\"less\">\n.sourcemap-list {\n  .card-header {\n    .title {\n      font-size: 16px;\n      font-weight: 600;\n    }\n  }\n  \n  .loading-container,\n  .empty-container {\n    min-height: 250px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n  \n  .file-name {\n    display: flex;\n    align-items: center;\n    gap: 5px;\n  }\n}\n</style>\n","<script setup lang=\"ts\">\nimport { ref, onMounted, watch } from 'vue'\nimport { useAppStore } from '../../store/app'\nimport { getSourceMaps } from '../../api'\nimport { ElMessage } from 'element-plus'\nimport SourceMapUploader from '../../components/sourcemap/SourceMapUploader.vue'\nimport SourceMapList from '../../components/sourcemap/SourceMapList.vue'\nimport type { SourceMapFile } from '../../api'\n\nconst appStore = useAppStore()\n\n// SourceMap文件列表\nconst sourceMapFiles = ref<SourceMapFile[]>([])\n\n// 加载状态\nconst loading = ref(false)\n\n// 加载SourceMap文件列表\nconst loadSourceMapFiles = async () => {\n\tif (!appStore.appId) {\n\t\tElMessage.warning('请先选择应用')\n\t\treturn\n\t}\n\n\tloading.value = true\n\tconsole.log('加载SourceMap文件列表...')\n\tconsole.log('应用ID:', appStore.appId)\n\n\ttry {\n\t\tconst data = await getSourceMaps(appStore.appId)\n\t\tconsole.log('SourceMap文件列表:', data)\n\t\tsourceMapFiles.value = data\n\t} catch (error) {\n\t\tconsole.error('加载SourceMap文件列表失败:', error)\n\t\tElMessage.error('加载SourceMap文件列表失败')\n\t} finally {\n\t\tloading.value = false\n\t}\n}\n\n// 处理上传成功\nconst handleUploadSuccess = () => {\n\tconsole.log('上传成功，重新加载文件列表')\n\tloadSourceMapFiles()\n}\n\n// 处理删除成功\nconst handleDeleteSuccess = () => {\n\tconsole.log('删除成功，重新加载文件列表')\n\tloadSourceMapFiles()\n}\n\n// 监听应用ID变化\nwatch(\n\t() => appStore.appId,\n\t(newAppId, oldAppId) => {\n\t\tif (newAppId !== oldAppId) {\n\t\t\tconsole.log('应用ID变化:', newAppId)\n\t\t\tloadSourceMapFiles()\n\t\t}\n\t},\n)\n\nonMounted(() => {\n\tconsole.log('Sourcemap页面已挂载')\n\tconsole.log('当前应用ID:', appStore.appId)\n\tloadSourceMapFiles()\n})\n</script>\n\n<template>\n\t<div class=\"sourcemap-container\">\n\t\t<div class=\"sourcemap-header\">\n\t\t\t<h2 class=\"page-title\">SourceMap管理</h2>\n\t\t\t<p class=\"page-description\">上传和管理应用的SourceMap文件，用于错误堆栈还原</p>\n\t\t</div>\n\n\t\t<!-- SourceMap文件上传组件 -->\n\t\t<SourceMapUploader :app-id=\"appStore.appId\" :on-success=\"handleUploadSuccess\" />\n\n\t\t<!-- SourceMap文件列表组件 -->\n\t\t<SourceMapList :data=\"sourceMapFiles\" :loading=\"loading\" :on-delete=\"handleDeleteSuccess\" />\n\t</div>\n</template>\n\n<style scoped lang=\"less\">\n.sourcemap-container {\n\tpadding: 20px;\n\n\t.sourcemap-header {\n\t\tmargin-bottom: 20px;\n\n\t\t.page-title {\n\t\t\tmargin: 0 0 10px 0;\n\t\t\tfont-size: 24px;\n\t\t\tfont-weight: 600;\n\t\t\tcolor: #303133;\n\t\t}\n\n\t\t.page-description {\n\t\t\tmargin: 0;\n\t\t\tfont-size: 14px;\n\t\t\tcolor: #606266;\n\t\t}\n\t}\n}\n</style>\n"],"names":["props","__props","uploadRef","ref","version","uploading","fileList","beforeUpload","file","ElMessage","maxSize","customUpload","response","uploadSourceMap","error","handleFileChange","uploadFile","uploadFiles","handleFileRemove","submitUpload","deletingId","formatFileSize","size","handleDelete","ElMessageBox","deleteSourceMap","getStatusType","status","getStatusText","appStore","useAppStore","sourceMapFiles","loading","loadSourceMapFiles","data","getSourceMaps","handleUploadSuccess","handleDeleteSuccess","watch","newAppId","oldAppId","onMounted"],"mappings":"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"}