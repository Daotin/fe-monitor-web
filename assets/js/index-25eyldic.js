const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./vendor-fcsvvV72.js","../css/vendor-4ESN5fw-.css"])))=>i.map(i=>d[i]);
import{q as sourceMapExports,r as errorStackParserExports}from"./vendor-fcsvvV72.js";import{a as ElMessage,d as edit_default,r as refresh_default,p as pointer_default,g as document_default,o as operation_default,l as link_default,m as mouse_default,h as calendar_default}from"./element-plus-CvvDIR_L.js";import{d as defineComponent,c as computed,l as ref,L as watch,h as createBlock,w as withCtx,r as resolveComponent,o as openBlock,V as withDirectives,aF as resolveDirective,b as createElementBlock,f as createVNode,e as createBaseVNode,k as createTextVNode,t as toDisplayString,i as createCommentVNode,F as Fragment,g as renderList,Z as onUnmounted,p as onMounted}from"./vue-vendor-DZbjFZat.js";import{_ as _export_sfc}from"./components-1ei5ehER.js";import{_ as __vitePreload}from"./index-D26BRtyA.js";import"./lodash-S0Y0Up6J.js";import"./store-vendor-BzeCd7_m.js";import"./utils-PfC8a2su.js";const _hoisted_1$3={key:0,class:"error-detail-content"},_hoisted_2$2={class:"stack-section"},_hoisted_3$2={class:"section-header"},_hoisted_4$1={key:0,class:"upload-sourcemap"},_hoisted_5={key:0,class:"parsed-stack"},_hoisted_6={class:"frame-number"},_hoisted_7={class:"frame-content"},_hoisted_8={class:"frame-function"},_hoisted_9={class:"frame-location"},_hoisted_10={class:"file-link"},_hoisted_11={class:"line-column"},_hoisted_12={key:1,class:"original-stack"},_hoisted_13={key:1,class:"error-empty"},_sfc_main$3=defineComponent({__name:"ErrorDetailDialog",props:{visible:{type:Boolean,default:!1},error:{type:Object,default:()=>({})}},emits:["update:visible"],setup(o,{emit:t}){const r=o,g=t,u=computed({get:()=>r.visible,set:l=>g("update:visible",l)}),f=ref(!1),n=ref(!1),s=ref(null),c=ref([]),y=computed(()=>c.value&&c.value.length>0);watch(()=>r.error,l=>{if(l)if(l.parsedStack&&l.parsedStack.length>0)c.value=l.parsedStack;else try{const a=new Error(l.message);a.stack=l.stack;const m=errorStackParserExports.parse(a);c.value=m.map(i=>({file:i.fileName||"",line:i.lineNumber||0,column:i.columnNumber||0,func:i.functionName||"(匿名函数)"}))}catch(a){console.error("解析错误堆栈失败:",a),c.value=[]}},{immediate:!0});const V=l=>{s.value=l},d=async()=>{if(!s.value||!s.value.raw){ElMessage.warning("请先选择SourceMap文件");return}if(!r.error||!r.error.stack){ElMessage.warning("错误堆栈信息不存在");return}try{n.value=!0;const l=await p(s.value.raw),a=new sourceMapExports.SourceMapConsumer(JSON.parse(l)),m=[];for(const i of c.value)try{const v=a.originalPositionFor({line:i.line,column:i.column});v.source?m.push({file:v.source,line:v.line||0,column:v.column||0,func:v.name||i.func}):m.push(i)}catch(v){console.error("解析堆栈帧失败:",v),m.push(i)}c.value=m,ElMessage.success("SourceMap解析成功")}catch(l){console.error("解析SourceMap失败:",l),ElMessage.error("解析SourceMap失败")}finally{n.value=!1}},p=l=>new Promise((a,m)=>{const i=new FileReader;i.onload=()=>a(i.result),i.onerror=m,i.readAsText(l)}),e=l=>{if(!l)return"(未知文件)";const a=l.split("/");return a[a.length-1]},_=()=>{u.value=!1,s.value=null};return(l,a)=>{const m=resolveComponent("el-descriptions-item"),i=resolveComponent("el-descriptions"),v=resolveComponent("el-button"),h=resolveComponent("el-upload"),k=resolveComponent("el-empty"),B=resolveComponent("el-dialog"),N=resolveDirective("loading");return openBlock(),createBlock(B,{title:"错误详情",modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=w=>u.value=w),width:"80%","destroy-on-close":"",onClose:_,class:"error-detail-dialog"},{default:withCtx(()=>[withDirectives((openBlock(),createElementBlock("div",null,[o.error?(openBlock(),createElementBlock("div",_hoisted_1$3,[createVNode(i,{title:"错误信息",column:1,border:""},{default:withCtx(()=>[createVNode(m,{label:"错误类型"},{default:withCtx(()=>[createTextVNode(toDisplayString(o.error.type),1)]),_:1}),createVNode(m,{label:"错误消息"},{default:withCtx(()=>[createTextVNode(toDisplayString(o.error.message),1)]),_:1}),createVNode(m,{label:"发生时间"},{default:withCtx(()=>[createTextVNode(toDisplayString(o.error.timestamp),1)]),_:1})]),_:1}),createBaseVNode("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$2,[a[4]||(a[4]=createBaseVNode("h3",null,"错误堆栈",-1)),y.value?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_4$1,[createVNode(h,{class:"sourcemap-uploader",action:"#","auto-upload":!1,limit:1,accept:".map,.json","on-change":V},{tip:withCtx(()=>a[2]||(a[2]=[createBaseVNode("div",{class:"el-upload__tip"},"请上传.map格式的SourceMap文件",-1)])),default:withCtx(()=>[createVNode(v,{type:"primary",loading:n.value},{default:withCtx(()=>a[1]||(a[1]=[createTextVNode("选择SourceMap文件")])),_:1},8,["loading"])]),_:1}),createVNode(v,{type:"success",disabled:!s.value,loading:n.value,onClick:d},{default:withCtx(()=>a[3]||(a[3]=[createTextVNode(" 解析源码 ")])),_:1},8,["disabled","loading"])]))]),y.value?(openBlock(),createElementBlock("div",_hoisted_5,[(openBlock(!0),createElementBlock(Fragment,null,renderList(c.value,(w,C)=>(openBlock(),createElementBlock("div",{key:C,class:"stack-frame"},[createBaseVNode("div",_hoisted_6,toDisplayString(C+1),1),createBaseVNode("div",_hoisted_7,[createBaseVNode("div",_hoisted_8,toDisplayString(w.func||"(匿名函数)"),1),createBaseVNode("div",_hoisted_9,[createBaseVNode("span",_hoisted_10,toDisplayString(e(w.file)),1),createBaseVNode("span",_hoisted_11,":"+toDisplayString(w.line)+":"+toDisplayString(w.column),1)])])]))),128))])):(openBlock(),createElementBlock("div",_hoisted_12,[createBaseVNode("pre",null,toDisplayString(o.error.stack),1)]))])])):(openBlock(),createElementBlock("div",_hoisted_13,[createVNode(k,{description:"无错误详情数据"})]))])),[[N,f.value]])]),_:1},8,["modelValue"])}}}),ErrorDetailDialog=_export_sfc(_sfc_main$3,[["__scopeId","data-v-16a06899"]]),_hoisted_1$2={key:0,class:"player-container-wrapper"},_sfc_main$2=defineComponent({__name:"RrwebPlayerDialog",props:{visible:{type:Boolean,default:!1},error:{type:Object,default:()=>({})}},emits:["update:visible"],setup(o,{emit:t}){const r=o,g=t,u=computed({get:()=>r.visible,set:d=>g("update:visible",d)}),f=ref(null),n=ref(null),s=ref(!1),c=computed(()=>{var d;return((d=r.error)==null?void 0:d.rrwebData)&&r.error.rrwebData.length>0});watch(()=>u.value,async d=>{if(d&&c.value){s.value=!0;try{await new Promise(p=>setTimeout(p,100)),await y()}catch(p){console.error("初始化播放器失败:",p),ElMessage.error("初始化播放器失败")}finally{s.value=!1}}});const y=async()=>{if(!(!c.value||!f.value||!r.error))try{const d=await __vitePreload(()=>import("./vendor-fcsvvV72.js").then(e=>e.t),__vite__mapDeps([0,1]),import.meta.url);await __vitePreload(()=>import("./vendor-fcsvvV72.js").then(e=>e.u),__vite__mapDeps([0,1]),import.meta.url);const p=d.default;n.value&&(n.value.destroy(),n.value=null),n.value=new p({target:f.value,props:{events:r.error.rrwebData,showController:!0,autoPlay:!1,width:f.value.clientWidth,height:Math.min(window.innerHeight*.6,600)}}),console.log("rrweb播放器初始化成功")}catch(d){throw console.error("初始化rrweb播放器失败:",d),d}},V=()=>{u.value=!1,n.value&&(n.value.destroy(),n.value=null)};return onUnmounted(()=>{n.value&&(n.value.destroy(),n.value=null)}),(d,p)=>{const e=resolveComponent("el-empty"),_=resolveComponent("el-dialog"),l=resolveDirective("loading");return openBlock(),createBlock(_,{title:"错误录屏回放",modelValue:u.value,"onUpdate:modelValue":p[0]||(p[0]=a=>u.value=a),width:"80%","destroy-on-close":"",onClose:V,class:"rrweb-player-dialog"},{default:withCtx(()=>[withDirectives((openBlock(),createElementBlock("div",null,[c.value?(openBlock(),createElementBlock("div",_hoisted_1$2,[createBaseVNode("div",{ref_key:"playerContainer",ref:f,class:"player-container"},null,512)])):s.value?createCommentVNode("",!0):(openBlock(),createBlock(e,{key:1,description:"暂无会话录屏数据"},{description:withCtx(()=>p[1]||(p[1]=[createBaseVNode("p",null,"该错误事件未包含会话录屏数据",-1),createBaseVNode("p",{class:"empty-tip"},"提示: 确保SDK配置中启用了rrweb插件，并设置了适当的录制模式",-1)])),_:1}))])),[[l,s.value]])]),_:1},8,["modelValue"])}}}),RrwebPlayerDialog=_export_sfc(_sfc_main$2,[["__scopeId","data-v-36eea481"]]),_hoisted_1$1={class:"behavior-item"},_hoisted_2$1={class:"behavior-type"},_hoisted_3$1={class:"behavior-detail"},_sfc_main$1=defineComponent({__name:"BehaviorStackDialog",props:{visible:{type:Boolean,default:!1},error:{type:Object,default:()=>({})}},emits:["update:visible"],setup(o,{emit:t}){const r=o,g=t,u=computed({get:()=>r.visible,set:e=>g("update:visible",e)}),f=ref(!1),n=computed(()=>{var e;return((e=r.error)==null?void 0:e.behaviorStack)&&r.error.behaviorStack.length>0}),s=computed(()=>!n.value||!r.error?[]:[...r.error.behaviorStack].sort((e,_)=>_.timestamp-e.timestamp)),c=e=>({click:"primary",input:"success",navigation:"warning",api:"danger",pageview:"info",scroll:"",resize:"",keypress:"success",error:"danger"})[e]||"",y=e=>({click:mouse_default,input:edit_default,navigation:link_default,api:operation_default,pageview:document_default,scroll:pointer_default,resize:refresh_default,keypress:edit_default,error:"CircleClose"})[e]||calendar_default,V=e=>e?new Date(e).toLocaleString():"",d=e=>{switch(e.type){case"click":return`点击了 ${e.element||"元素"} ${e.text?`"${e.text}"`:""} ${e.position?`位置(${e.position.x}, ${e.position.y})`:""}`;case"input":return`在 ${e.element||"输入框"} 中输入内容`;case"navigation":return`从 ${e.from||"未知页面"} 导航到 ${e.to||"未知页面"}`;case"api":return`${e.method||"GET"} 请求 ${e.url||"未知接口"} ${e.status?`状态码: ${e.status}`:""}`;case"pageview":return`访问页面 ${e.url||"未知页面"} ${e.title?`"${e.title}"`:""}`;case"scroll":return`滚动到位置 ${e.position?`(${e.position.x}, ${e.position.y})`:"未知位置"}`;case"keypress":return`按键 ${e.key||"未知按键"}`;case"error":return`发生错误: ${e.message||"未知错误"}`;default:return JSON.stringify(e)}},p=()=>{u.value=!1};return(e,_)=>{const l=resolveComponent("el-tag"),a=resolveComponent("el-timeline-item"),m=resolveComponent("el-timeline"),i=resolveComponent("el-empty"),v=resolveComponent("el-dialog"),h=resolveDirective("loading");return openBlock(),createBlock(v,{title:"用户行为记录",modelValue:u.value,"onUpdate:modelValue":_[0]||(_[0]=k=>u.value=k),width:"80%","destroy-on-close":"",onClose:p,class:"behavior-stack-dialog"},{default:withCtx(()=>[withDirectives((openBlock(),createElementBlock("div",null,[n.value?(openBlock(),createBlock(m,{key:0},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(s.value,(k,B)=>(openBlock(),createBlock(a,{key:B,type:c(k.type),icon:y(k.type),timestamp:V(k.timestamp),size:"large"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[createVNode(l,{size:"small",type:c(k.type)},{default:withCtx(()=>[createTextVNode(toDisplayString(k.type),1)]),_:2},1032,["type"])]),createBaseVNode("div",_hoisted_3$1,toDisplayString(d(k)),1)])]),_:2},1032,["type","icon","timestamp"]))),128))]),_:1})):f.value?createCommentVNode("",!0):(openBlock(),createBlock(i,{key:1,description:"暂无用户行为记录"},{description:withCtx(()=>_[1]||(_[1]=[createBaseVNode("p",null,"该错误事件未包含用户行为记录",-1),createBaseVNode("p",{class:"empty-tip"},"提示: 确保SDK配置中启用了behaviorStack插件",-1)])),_:1}))])),[[h,f.value]])]),_:1},8,["modelValue"])}}}),BehaviorStackDialog=_export_sfc(_sfc_main$1,[["__scopeId","data-v-a3ab500b"]]),_hoisted_1={class:"demo-container"},_hoisted_2={class:"error-trigger-section"},_hoisted_3={class:"error-buttons"},_hoisted_4={class:"error-list-section"},_sfc_main=defineComponent({__name:"index",setup(__props){const errorList=ref([]),currentError=ref(null),errorDetailVisible=ref(!1),rrwebPlayerVisible=ref(!1),behaviorStackVisible=ref(!1);onMounted(()=>{window.addEventListener("monitor-error",handleMonitorError)}),onUnmounted(()=>{window.removeEventListener("monitor-error",handleMonitorError)});const handleMonitorError=o=>{console.log("捕获到错误:",o.detail);const t=o.detail,r={id:generateId(),timestamp:new Date().toLocaleString(),type:t.type||"未知错误",message:t.message||"未知错误信息",stack:t.stack||"",parsedStack:t.parsedStack,rrwebData:t.rrwebData,behaviorStack:t.behaviorStack};errorList.value.unshift(r),ElMessage.success("错误已捕获并添加到列表")},generateId=()=>Date.now().toString(36)+Math.random().toString(36).substring(2),triggerTypeError=()=>{console.log("即将触发JS加载错误..."),null.b&&console.log("触发JS加载错误")},triggerReferenceError=()=>{try{console.log(undefinedVariable)}catch(o){console.error("手动触发引用错误:",o)}},triggerSyntaxError=()=>{try{eval("if(true) {")}catch(o){console.error("手动触发语法错误:",o)}},triggerPromiseError=()=>{Promise.reject(new Error("这是一个Promise错误")).catch(o=>{console.error("手动触发Promise错误:",o)})},triggerResourceError=()=>{const o=new Image;o.src="/non-existent-image.jpg"},triggerCustomError=()=>{try{throw new Error("这是一个自定义错误")}catch(o){console.error("手动触发自定义错误:",o)}},showErrorDetail=o=>{currentError.value=o,errorDetailVisible.value=!0},showRrwebPlayer=o=>{currentError.value=o,rrwebPlayerVisible.value=!0},showBehaviorStack=o=>{currentError.value=o,behaviorStackVisible.value=!0};return(o,t)=>{const r=resolveComponent("el-button"),g=resolveComponent("el-table-column"),u=resolveComponent("el-table"),f=resolveComponent("el-empty"),n=resolveComponent("el-card");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(n,{class:"demo-card"},{header:withCtx(()=>t[3]||(t[3]=[createBaseVNode("div",{class:"card-header"},[createBaseVNode("h2",null,"错误采集和还原定位演示"),createBaseVNode("p",{class:"description"}," 本页面用于演示前端监控SDK的错误采集和还原定位功能，包括sourcemap定位源码、播放录屏和记录用户行为记录。 ")],-1)])),default:withCtx(()=>[createBaseVNode("div",_hoisted_2,[t[10]||(t[10]=createBaseVNode("h3",null,"触发错误",-1)),t[11]||(t[11]=createBaseVNode("p",null,"点击下方按钮触发不同类型的错误，错误将被自动捕获并显示在下方列表中。",-1)),createBaseVNode("div",_hoisted_3,[createVNode(r,{type:"danger",onClick:triggerTypeError},{default:withCtx(()=>t[4]||(t[4]=[createTextVNode("触发类型错误")])),_:1}),createVNode(r,{type:"danger",onClick:triggerReferenceError},{default:withCtx(()=>t[5]||(t[5]=[createTextVNode("触发引用错误")])),_:1}),createVNode(r,{type:"danger",onClick:triggerSyntaxError},{default:withCtx(()=>t[6]||(t[6]=[createTextVNode("触发语法错误")])),_:1}),createVNode(r,{type:"danger",onClick:triggerPromiseError},{default:withCtx(()=>t[7]||(t[7]=[createTextVNode("触发Promise错误")])),_:1}),createVNode(r,{type:"danger",onClick:triggerResourceError},{default:withCtx(()=>t[8]||(t[8]=[createTextVNode("触发资源加载错误")])),_:1}),createVNode(r,{type:"danger",onClick:triggerCustomError},{default:withCtx(()=>t[9]||(t[9]=[createTextVNode("触发自定义错误")])),_:1})])]),createBaseVNode("div",_hoisted_4,[t[15]||(t[15]=createBaseVNode("h3",null,"错误列表",-1)),errorList.value.length?(openBlock(),createBlock(u,{key:0,data:errorList.value,style:{width:"100%"},border:""},{default:withCtx(()=>[createVNode(g,{prop:"timestamp",label:"时间",width:"180"}),createVNode(g,{prop:"type",label:"错误类型",width:"150"}),createVNode(g,{prop:"message",label:"错误信息"}),createVNode(g,{label:"操作",width:"300"},{default:withCtx(s=>[createVNode(r,{size:"small",onClick:c=>showErrorDetail(s.row)},{default:withCtx(()=>t[12]||(t[12]=[createTextVNode("错误详情")])),_:2},1032,["onClick"]),createVNode(r,{size:"small",onClick:c=>showRrwebPlayer(s.row)},{default:withCtx(()=>t[13]||(t[13]=[createTextVNode("播放录屏")])),_:2},1032,["onClick"]),createVNode(r,{size:"small",onClick:c=>showBehaviorStack(s.row)},{default:withCtx(()=>t[14]||(t[14]=[createTextVNode("行为记录")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])):(openBlock(),createBlock(f,{key:1,description:"暂无错误，请点击上方按钮触发错误"}))])]),_:1}),createVNode(ErrorDetailDialog,{visible:errorDetailVisible.value,"onUpdate:visible":t[0]||(t[0]=s=>errorDetailVisible.value=s),error:currentError.value},null,8,["visible","error"]),createVNode(RrwebPlayerDialog,{visible:rrwebPlayerVisible.value,"onUpdate:visible":t[1]||(t[1]=s=>rrwebPlayerVisible.value=s),error:currentError.value},null,8,["visible","error"]),createVNode(BehaviorStackDialog,{visible:behaviorStackVisible.value,"onUpdate:visible":t[2]||(t[2]=s=>behaviorStackVisible.value=s),error:currentError.value},null,8,["visible","error"])])}}}),index=_export_sfc(_sfc_main,[["__scopeId","data-v-c6b24a27"]]);export{index as default};
//# sourceMappingURL=index-25eyldic.js.map
