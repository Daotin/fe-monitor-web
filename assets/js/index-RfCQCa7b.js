import{_ as b,u as F,T as V}from"./components-BPZC1Siq.js";import{g as M,a as P,b as N}from"./index-CUuj7Ipo.js";import{a as U,f as j,t as J,b as G}from"./utils-PfC8a2su.js";import{d as S,c as A,r as d,h,o as u,w as r,e as i,P as R,f as o,j as O,t as g,b as w,F as B,k as I,l as E,L as D,p as z,a1 as W,u as q,g as H,m as k}from"./vue-vendor-DZbjFZat.js";import{u as K,i as Q,L as X,a as Y,b as Z,c as ee,d as te,e as ae,f as oe,g as se,h as re}from"./echarts-DsNzUyfI.js";import{a as $}from"./element-plus-ppjtjl3f.js";import"./store-vendor-BzeCd7_m.js";import"./utils-vendor-t--hEgTQ.js";import"./vendor-C47yNhyI.js";import"./lodash-S0Y0Up6J.js";const ne={class:"stat-card-content"},le={class:"stat-card-info"},ie={class:"stat-card-title"},ce={class:"stat-card-value"},de=S({__name:"StatCard",props:{title:{},value:{},icon:{default:"DataLine"},color:{default:"#409EFF"},prefix:{default:""},suffix:{default:""},isPerformance:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},setup(y){const e=y,n=A(()=>e.loading?"-":e.isPerformance&&typeof e.value=="number"?U(e.value):e.prefix+e.value+e.suffix);return(a,v)=>{const s=d("el-icon"),l=d("el-skeleton"),c=d("el-card");return u(),h(c,{class:"stat-card",shadow:"hover"},{default:r(()=>[i("div",ne,[i("div",{class:"stat-card-icon",style:R({backgroundColor:a.color})},[o(s,null,{default:r(()=>[(u(),h(O(a.icon)))]),_:1})],4),i("div",le,[i("div",ie,g(a.title),1),i("div",ce,[a.loading?(u(),h(l,{key:0,rows:1,animated:""})):(u(),w(B,{key:1},[I(g(n.value),1)],64))])])])]),_:1})}}}),x=b(de,[["__scopeId","data-v-e2f99c4d"]]),ue=S({__name:"ErrorTrendChart",props:{data:{},loading:{type:Boolean,default:!1},height:{default:"350px"}},setup(y){K([Y,Z,ee,te,ae,oe,se,re]);const e=y,n=E(null);let a=null;const v=()=>{n.value&&(a=Q(n.value),s(),window.addEventListener("resize",l))},s=()=>{if(!a)return;const c=e.data.map(p=>p.date),T=e.data.map(p=>p.count),f={title:{text:"JS错误趋势",left:"center"},tooltip:{trigger:"axis",formatter:function(p){const t=p[0];return`${t.name}<br/>${t.seriesName}: ${t.value}`}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:c,axisLabel:{formatter:p=>j(p,"MM-DD")}},yAxis:{type:"value",name:"错误数",nameTextStyle:{padding:[0,0,0,40]}},series:[{name:"错误数",type:"line",data:T,smooth:!0,showSymbol:!0,symbolSize:6,lineStyle:{width:3,color:"#E6A23C"},itemStyle:{color:"#E6A23C"},areaStyle:{color:new X(0,0,0,1,[{offset:0,color:"rgba(230, 162, 60, 0.5)"},{offset:1,color:"rgba(230, 162, 60, 0.1)"}])}}]};e.loading?a.showLoading({text:"加载中...",maskColor:"rgba(255, 255, 255, 0.8)",fontSize:14}):(a.hideLoading(),a.setOption(f))},l=()=>{a==null||a.resize()};return D(()=>e.data,s,{deep:!0}),D(()=>e.loading,s),z(()=>{v()}),W(()=>{a&&(a.dispose(),a=null),window.removeEventListener("resize",l)}),(c,T)=>{const f=d("el-card");return u(),h(f,{class:"error-trend-chart",shadow:"hover"},{default:r(()=>[i("div",{ref_key:"chartRef",ref:n,style:R({height:c.height,width:"100%"})},null,4)]),_:1})}}}),pe=b(ue,[["__scopeId","data-v-ff0d8c67"]]),me={class:"card-header"},fe={key:2,class:"error-list-content"},_e=["onClick"],ge={class:"error-item-header"},ve={class:"error-count"},he={class:"error-message"},ye={class:"error-meta"},Te=S({__name:"ErrorList",props:{data:{},loading:{type:Boolean,default:!1},title:{default:"Top 5 JS错误"}},setup(y){const e=y,n=q(),a=l=>{n.push({name:"ErrorDetail",params:{id:l.sampleEventId}})},v=l=>({TypeError:"danger",ReferenceError:"warning",SyntaxError:"info",RangeError:"warning",URIError:"info"})[l]||"info",s=A(()=>!e.loading&&(!e.data||e.data.length===0));return(l,c)=>{const T=d("ArrowRight"),f=d("el-icon"),p=d("el-button"),t=d("el-skeleton"),L=d("el-empty"),C=d("el-tag"),_=d("el-card");return u(),h(_,{class:"error-list",shadow:"hover"},{header:r(()=>[i("div",me,[i("span",null,g(l.title),1),o(p,{class:"more-btn",text:"",type:"primary",onClick:c[0]||(c[0]=m=>k(n).push("/error"))},{default:r(()=>[c[1]||(c[1]=I(" 查看更多 ")),o(f,null,{default:r(()=>[o(T)]),_:1})]),_:1})])]),default:r(()=>[l.loading?(u(),h(t,{key:0,rows:5,animated:""})):s.value?(u(),h(L,{key:1,description:"暂无错误数据"})):(u(),w("div",fe,[(u(!0),w(B,null,H(l.data,m=>(u(),w("div",{key:m.fingerprint,class:"error-item",onClick:xe=>a(m)},[i("div",ge,[o(C,{type:v(m.type),size:"small"},{default:r(()=>[I(g(m.type),1)]),_:2},1032,["type"]),i("span",ve,g(m.count)+"次",1)]),i("div",he,g(k(J)(m.message,80)),1),i("div",ye,[i("span",null,"影响"+g(m.userCount)+"个用户",1),i("span",null,"最近发生: "+g(k(G)(m.lastSeen)),1)])],8,_e))),128))]))]),_:1})}}}),Ce=b(Te,[["__scopeId","data-v-4ef3e7a1"]]),Ee={class:"dashboard-container"},we=S({__name:"index",setup(y){const e=F(),n=E({pvCount:0,uvCount:0,jsErrorCount:0,lcpAvg:0}),a=E([]),v=E([]),s=E({stats:!0,trend:!0,list:!0}),l=async()=>{try{s.value.stats=!0,console.log("获取核心统计指标，参数:",{appId:e.appId,startTime:e.startTime,endTime:e.endTime});const t=await M(e.appId,e.startTime,e.endTime);n.value=t,console.log("核心统计指标数据:",t)}catch(t){console.error("获取核心统计指标失败:",t),$.error("获取核心统计指标失败")}finally{s.value.stats=!1}},c=async()=>{try{s.value.trend=!0,console.log("获取错误趋势数据，参数:",{appId:e.appId,startTime:e.startTime,endTime:e.endTime,interval:"day"});const t=await P(e.appId,e.startTime,e.endTime,"day");a.value=t,console.log("✅错误趋势数据:",t)}catch(t){console.error("获取错误趋势数据失败:",t),$.error("获取错误趋势数据失败")}finally{s.value.trend=!1}},T=async()=>{try{s.value.list=!0,console.log("获取错误列表数据，参数:",{appId:e.appId,startTime:e.startTime,endTime:e.endTime,page:1,limit:5,sortBy:"count_desc"});const t=await N(e.appId,e.startTime,e.endTime,1,5,"count_desc");v.value=t.items,console.log("错误列表数据:",t)}catch(t){console.error("获取错误列表数据失败:",t),$.error("获取错误列表数据失败")}finally{s.value.list=!1}},f=()=>{l(),c(),T()},p=t=>{e.setTimeRange(t)};return D(()=>[e.appId,e.startTime,e.endTime],()=>{f()}),z(()=>{console.log("Dashboard页面已挂载"),console.log("当前应用ID:",e.appId),console.log("当前时间范围:",e.timeRange),console.log("开始时间:",e.startTime),console.log("结束时间:",e.endTime),f()}),(t,L)=>{const C=d("el-row"),_=d("el-col");return u(),w("div",Ee,[o(C,{class:"time-filter"},{default:r(()=>[o(V,{onChange:p})]),_:1}),o(C,{gutter:20,class:"stat-cards"},{default:r(()=>[o(_,{xs:24,sm:12,md:6},{default:r(()=>[o(x,{title:"页面访问量 (PV)",value:n.value.pvCount,icon:"View",color:"#409EFF",loading:s.value.stats},null,8,["value","loading"])]),_:1}),o(_,{xs:24,sm:12,md:6},{default:r(()=>[o(x,{title:"独立访客数 (UV)",value:n.value.uvCount,icon:"User",color:"#67C23A",loading:s.value.stats},null,8,["value","loading"])]),_:1}),o(_,{xs:24,sm:12,md:6},{default:r(()=>[o(x,{title:"JS错误数",value:n.value.jsErrorCount,icon:"Warning",color:"#F56C6C",loading:s.value.stats},null,8,["value","loading"])]),_:1}),o(_,{xs:24,sm:12,md:6},{default:r(()=>[o(x,{title:"LCP均值",value:n.value.lcpAvg,icon:"Timer",color:"#E6A23C",loading:s.value.stats,"is-performance":!0},null,8,["value","loading"])]),_:1})]),_:1}),o(C,{gutter:20,class:"charts-container"},{default:r(()=>[o(_,{xs:24,lg:14},{default:r(()=>[o(pe,{data:a.value,loading:s.value.trend},null,8,["data","loading"])]),_:1}),o(_,{xs:24,lg:10},{default:r(()=>[o(Ce,{data:v.value,loading:s.value.list},null,8,["data","loading"])]),_:1})]),_:1})])}}}),ze=b(we,[["__scopeId","data-v-c1c0f9be"]]);export{ze as default};
//# sourceMappingURL=index-RfCQCa7b.js.map
