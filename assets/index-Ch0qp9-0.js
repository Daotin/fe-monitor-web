import{u as $}from"./app-CZDtxeHb.js";import{u as T,h as V,i as L}from"./index-Cn3Jm4lI.js";import{d as C,l as h,h as k,w as o,r as c,o as S,e as m,f as a,k as v,t as g,D as i,b as F,L as j,y as E,s as R,m as z}from"./index-DEoX-3sF.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"upload-form"},G=C({__name:"SourceMapUploader",props:{appId:{},onSuccess:{type:Function}},setup(M){const s=M,f=h(),r=h(""),d=h(!1),p=h([]),y=u=>{if(!u.name.endsWith(".map")&&!u.name.endsWith(".js.map"))return i.error("请上传.map或.js.map后缀的SourceMap文件"),!1;const l=20*1024*1024;return u.size>l?(i.error("文件大小不能超过20MB"),!1):r.value?!0:(i.warning("请输入版本号"),!1)},e=async u=>{if(!s.appId){i.warning("请先选择应用");return}try{d.value=!0,console.log("上传文件:",u.name),console.log("应用ID:",s.appId),console.log("版本号:",r.value);const l=await T(s.appId,u,r.value);console.log("上传成功:",l),i.success(`文件 ${u.name} 上传成功`),p.value=[],r.value="",s.onSuccess&&s.onSuccess()}catch(l){console.error("上传失败:",l),i.error("文件上传失败，请重试")}finally{d.value=!1}},t=(u,l)=>{console.log("文件变化:",u.name),p.value=l},I=()=>{p.value=[]},x=()=>{if(p.value.length===0){i.warning("请先选择文件");return}if(!r.value){i.warning("请输入版本号");return}const u=p.value[0].raw;e(u)};return(u,l)=>{const _=c("el-input"),b=c("el-form-item"),w=c("el-button"),D=c("el-upload"),B=c("el-form"),n=c("el-card");return S(),k(n,{class:"sourcemap-uploader"},{header:o(()=>l[1]||(l[1]=[m("div",{class:"card-header"},[m("span",{class:"title"},"上传SourceMap文件")],-1)])),default:o(()=>[m("div",W,[a(B,{"label-position":"top"},{default:o(()=>[a(b,{label:"应用ID"},{default:o(()=>[a(_,{"model-value":s.appId,disabled:"",placeholder:"应用ID"},null,8,["model-value"])]),_:1}),a(b,{label:"版本号"},{default:o(()=>[a(_,{modelValue:r.value,"onUpdate:modelValue":l[0]||(l[0]=U=>r.value=U),placeholder:"请输入版本号，例如: 1.0.0",disabled:d.value},null,8,["modelValue","disabled"])]),_:1}),a(b,{label:"SourceMap文件"},{default:o(()=>[a(D,{ref_key:"uploadRef",ref:f,class:"sourcemap-upload",action:"#","auto-upload":!1,limit:1,"file-list":p.value,"before-upload":y,"on-change":t,"on-remove":I,disabled:d.value},{trigger:o(()=>[a(w,{type:"primary",disabled:d.value},{default:o(()=>l[2]||(l[2]=[v("选择文件")])),_:1},8,["disabled"])]),tip:o(()=>l[3]||(l[3]=[m("div",{class:"el-upload__tip"},"请上传.map或.js.map后缀的SourceMap文件，大小不超过20MB",-1)])),_:1},8,["file-list","disabled"])]),_:1}),a(b,null,{default:o(()=>[a(w,{type:"success",onClick:x,loading:d.value,disabled:p.value.length===0||!r.value},{default:o(()=>[v(g(d.value?"上传中...":"上传文件"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})])]),_:1})}}}),K=N(G,[["__scopeId","data-v-d90dc990"]]),q={key:0,class:"loading-container"},A={key:1,class:"empty-container"},H={class:"file-name"},J=C({__name:"SourceMapList",props:{data:{default:()=>[]},loading:{type:Boolean,default:!1},onDelete:{}},setup(M){const s=M,f=h(null),r=e=>e<1024?e+" B":e<1024*1024?(e/1024).toFixed(2)+" KB":e<1024*1024*1024?(e/(1024*1024)).toFixed(2)+" MB":(e/(1024*1024*1024)).toFixed(2)+" GB",d=async e=>{try{await j.confirm(`确定要删除文件 ${e.fileName} 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),f.value=e.id,console.log("删除文件:",e.id,e.fileName);const t=await V(e.id);console.log("删除结果:",t),t.success?(i.success("文件删除成功"),s.onDelete&&s.onDelete()):i.error("文件删除失败")}catch(t){t!=="cancel"&&(console.error("删除文件失败:",t),i.error("删除文件失败，请重试"))}finally{f.value=null}},p=e=>{switch(e){case"active":return"success";case"inactive":return"info";default:return""}},y=e=>{switch(e){case"active":return"活跃";case"inactive":return"未使用";default:return e}};return(e,t)=>{const I=c("el-skeleton"),x=c("el-empty"),u=c("Document"),l=c("el-icon"),_=c("el-table-column"),b=c("el-tag"),w=c("el-button"),D=c("el-table"),B=c("el-card");return S(),k(B,{class:"sourcemap-list"},{header:o(()=>t[0]||(t[0]=[m("div",{class:"card-header"},[m("span",{class:"title"},"已上传的SourceMap文件")],-1)])),default:o(()=>[e.loading?(S(),F("div",q,[a(I,{animated:"",rows:5})])):e.data.length===0?(S(),F("div",A,[a(x,{description:"暂无上传的SourceMap文件","image-size":80})])):(S(),k(D,{key:2,data:e.data,style:{width:"100%"},size:"large"},{default:o(()=>[a(_,{label:"文件名","min-width":"200","show-overflow-tooltip":""},{default:o(({row:n})=>[m("div",H,[a(l,null,{default:o(()=>[a(u)]),_:1}),m("span",null,g(n.fileName),1)])]),_:1}),a(_,{label:"原始文件","min-width":"180","show-overflow-tooltip":""},{default:o(({row:n})=>[v(g(n.originalFileName),1)]),_:1}),a(_,{label:"版本",width:"100"},{default:o(({row:n})=>[v(g(n.version),1)]),_:1}),a(_,{label:"大小",width:"100"},{default:o(({row:n})=>[v(g(r(n.size)),1)]),_:1}),a(_,{label:"状态",width:"100"},{default:o(({row:n})=>[a(b,{type:p(n.status),size:"small"},{default:o(()=>[v(g(y(n.status)),1)]),_:2},1032,["type"])]),_:1}),a(_,{label:"上传时间","min-width":"180"},{default:o(({row:n})=>[v(g(n.uploadTime),1)]),_:1}),a(_,{label:"操作",width:"100",fixed:"right"},{default:o(({row:n})=>[a(w,{type:"danger",size:"small",loading:f.value===n.id,onClick:U=>d(n)},{default:o(()=>t[1]||(t[1]=[v(" 删除 ")])),_:2},1032,["loading","onClick"])]),_:1})]),_:1},8,["data"]))]),_:1})}}}),O=N(J,[["__scopeId","data-v-85dcb2d9"]]),P={class:"sourcemap-container"},Q=C({__name:"index",setup(M){const s=$(),f=h([]),r=h(!1),d=async()=>{if(!s.appId){i.warning("请先选择应用");return}r.value=!0,console.log("加载SourceMap文件列表..."),console.log("应用ID:",s.appId);try{const e=await L(s.appId);console.log("SourceMap文件列表:",e),f.value=e}catch(e){console.error("加载SourceMap文件列表失败:",e),i.error("加载SourceMap文件列表失败")}finally{r.value=!1}},p=()=>{console.log("上传成功，重新加载文件列表"),d()},y=()=>{console.log("删除成功，重新加载文件列表"),d()};return E(()=>s.appId,(e,t)=>{e!==t&&(console.log("应用ID变化:",e),d())}),R(()=>{console.log("Sourcemap页面已挂载"),console.log("当前应用ID:",s.appId),d()}),(e,t)=>(S(),F("div",P,[t[0]||(t[0]=m("div",{class:"sourcemap-header"},[m("h2",{class:"page-title"},"SourceMap管理"),m("p",{class:"page-description"},"上传和管理应用的SourceMap文件，用于错误堆栈还原")],-1)),a(K,{"app-id":z(s).appId,"on-success":p},null,8,["app-id"]),a(O,{data:f.value,loading:r.value,"on-delete":y},null,8,["data","loading"])]))}}),ae=N(Q,[["__scopeId","data-v-d199f6f9"]]);export{ae as default};
