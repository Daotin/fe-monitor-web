import{u as V}from"./app-CzQtJvH7.js";import{d as x,e as N,f as z}from"./index-Ctt3lMUz.js";import{d as I,c as $,h as T,o as d,w as o,e as r,b as g,f as e,r as i,j as F,t as h,x as S,v as R,F as U,g as A,k as b,m as B,A as Y,l as E,y as H,s as O,D as L}from"./index-CvzVNLo0.js";import{_ as D}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{T as j}from"./TimeRangeSelector-Bv3_omVH.js";const q={class:"card-header"},G={class:"title"},J={key:0,class:"loading-container"},K={key:1,class:"metrics-container"},Q={class:"metric-item"},W={class:"metric-item"},X=I({__name:"PerformanceMetricCard",props:{title:{},avgValue:{},p75Value:{},icon:{default:"Timer"},color:{default:"#409EFF"},loading:{type:Boolean,default:!1},threshold:{default:()=>({good:1e3,needsImprovement:2500})}},setup(P){const a=P,m=t=>R(t),y=t=>t<=a.threshold.good?"#67C23A":t<=a.threshold.needsImprovement?"#E6A23C":"#F56C6C",f=$(()=>y(a.avgValue)),n=$(()=>y(a.p75Value));return(t,v)=>{const u=i("el-icon"),c=i("el-skeleton"),p=i("el-card");return d(),T(p,{class:"metric-card","body-style":{padding:"15px"}},{default:o(()=>[r("div",q,[r("div",G,[e(u,{size:20,color:t.color},{default:o(()=>[(d(),T(F(t.icon)))]),_:1},8,["color"]),r("span",null,h(t.title),1)])]),t.loading?(d(),g("div",J,[e(c,{animated:"",rows:2})])):(d(),g("div",K,[r("div",Q,[v[0]||(v[0]=r("div",{class:"metric-label"},"平均值",-1)),r("div",{class:"metric-value",style:S({color:f.value})},h(m(t.avgValue)),5)]),r("div",W,[v[1]||(v[1]=r("div",{class:"metric-label"},"P75",-1)),r("div",{class:"metric-value",style:S({color:n.value})},h(m(t.p75Value)),5)])]))]),_:1})}}}),M=D(X,[["__scopeId","data-v-a000fcd3"]]),Z={class:"card-header"},ee={key:0,class:"loading-container"},te={key:1,class:"empty-container"},oe={key:2,class:"pages-list"},ae={class:"list-header"},se={class:"value-header"},le=["title"],ne=I({__name:"SlowPagesList",props:{data:{default:()=>[]},loading:{type:Boolean,default:!1},metric:{default:"lcp"}},emits:["update:metric"],setup(P,{emit:a}){const m=P,y=a,f={lcp:"LCP (最大内容绘制)",fcp:"FCP (首次内容绘制)"},n=$(()=>f[m.metric]||m.metric.toUpperCase()),t=(u,c)=>{const p={lcp:{good:2500,needsImprovement:4e3},fcp:{good:1e3,needsImprovement:2500}},_=p[c]||p.lcp;return u<=_.good?"#67C23A":u<=_.needsImprovement?"#E6A23C":"#F56C6C"},v=u=>u.length>40?u.substring(0,40)+"...":u;return(u,c)=>{const p=i("el-radio-button"),_=i("el-radio-group"),k=i("el-skeleton"),s=i("el-empty"),C=i("el-card");return d(),T(C,{class:"slow-pages-card"},{header:o(()=>[r("div",Z,[c[3]||(c[3]=r("span",{class:"title"},"Top 5 慢页面",-1)),e(_,{"model-value":m.metric,"onUpdate:modelValue":c[0]||(c[0]=l=>y("update:metric",l)),size:"small"},{default:o(()=>[e(p,{label:"lcp"},{default:o(()=>c[1]||(c[1]=[b("LCP")])),_:1}),e(p,{label:"fcp"},{default:o(()=>c[2]||(c[2]=[b("FCP")])),_:1})]),_:1},8,["model-value"])])]),default:o(()=>[u.loading?(d(),g("div",ee,[e(k,{animated:"",rows:5})])):u.data.length===0?(d(),g("div",te,[e(s,{description:"暂无数据","image-size":80})])):(d(),g("div",oe,[r("div",ae,[c[4]||(c[4]=r("span",{class:"url-header"},"页面URL",-1)),r("span",se,h(n.value),1)]),(d(!0),g(U,null,A(u.data,(l,w)=>(d(),g("div",{key:w,class:"page-item"},[r("div",{class:"page-url",title:l.url},h(v(l.url)),9,le),r("div",{class:"page-value",style:S({color:t(l.value,m.metric)})},h(B(R)(l.value)),5)]))),128))]))]),_:1})}}}),re=D(ne,[["__scopeId","data-v-430de9b5"]]),ce={key:0,class:"loading-container"},ie={key:1,class:"empty-container"},de={class:"url-text"},ue={key:0},me={key:1},pe=I({__name:"ResourceErrorsList",props:{data:{default:()=>[]},loading:{type:Boolean,default:!1}},setup(P){const a=n=>n.length>40?n.substring(0,40)+"...":n,m=n=>Y(new Date(n),"YYYY-MM-DD HH:mm:ss"),y=n=>({script:"Document",link:"Link",img:"Picture",video:"VideoPlay",audio:"Headset",iframe:"Monitor"})[n.toLowerCase()]||"Document",f=n=>n.includes("404")?"danger":n.includes("ERR_CONNECTION")||n.includes("TIMEOUT")?"warning":(n.includes("CERT"),"info");return(n,t)=>{const v=i("el-skeleton"),u=i("el-empty"),c=i("el-icon"),p=i("el-tooltip"),_=i("el-table-column"),k=i("el-tag"),s=i("el-table"),C=i("el-card");return d(),T(C,{class:"resource-errors-card"},{header:o(()=>t[0]||(t[0]=[r("div",{class:"card-header"},[r("span",{class:"title"},"资源加载错误")],-1)])),default:o(()=>[n.loading?(d(),g("div",ce,[e(v,{animated:"",rows:5})])):n.data.length===0?(d(),g("div",ie,[e(u,{description:"暂无数据","image-size":80})])):(d(),T(s,{key:2,data:n.data,style:{width:"100%"},size:"large"},{default:o(()=>[e(_,{label:"资源类型",width:"80"},{default:o(({row:l})=>[e(p,{content:l.tagName,placement:"top"},{default:o(()=>[e(c,{size:20},{default:o(()=>[(d(),T(F(y(l.tagName))))]),_:2},1024)]),_:2},1032,["content"])]),_:1}),e(_,{label:"资源URL","min-width":"200"},{default:o(({row:l})=>[e(p,{content:l.url,placement:"top","show-after":500},{default:o(()=>[r("span",de,h(a(l.url)),1)]),_:2},1032,["content"])]),_:1}),e(_,{label:"错误类型","min-width":"180"},{default:o(({row:l})=>[e(k,{type:f(l.type),size:"small"},{default:o(()=>[b(h(l.type),1)]),_:2},1032,["type"])]),_:1}),e(_,{label:"状态码",width:"100",align:"center"},{default:o(({row:l})=>[l.status?(d(),g("span",ue,h(l.status),1)):(d(),g("span",me,"-"))]),_:1}),e(_,{label:"发生时间","min-width":"180"},{default:o(({row:l})=>[b(h(m(l.timestamp)),1)]),_:1})]),_:1},8,["data"]))]),_:1})}}}),_e=D(pe,[["__scopeId","data-v-7f02431c"]]),ge={class:"performance-container"},fe=I({__name:"index",setup(P){const a=V(),m=E({lcp:{avg:0,p75:0},fcp:{avg:0,p75:0}}),y=E([]),f=E("lcp"),n=E([]),t=E({performance:!1,slowPages:!1,resourceErrors:!1}),v=async()=>{t.value.performance=!0,console.log("加载性能指标数据..."),console.log("应用ID:",a.appId),console.log("开始时间:",a.startTime),console.log("结束时间:",a.endTime);try{const s=await x(a.appId,a.startTime,a.endTime);console.log("性能指标数据:",s),m.value=s}catch(s){console.error("加载性能指标数据失败:",s),L.error("加载性能指标数据失败")}finally{t.value.performance=!1}},u=async()=>{t.value.slowPages=!0,console.log("加载慢页面数据..."),console.log("指标类型:",f.value);try{const s=await N(a.appId,a.startTime,a.endTime,f.value,5);console.log("慢页面数据:",s),y.value=s}catch(s){console.error("加载慢页面数据失败:",s),L.error("加载慢页面数据失败")}finally{t.value.slowPages=!1}},c=async()=>{t.value.resourceErrors=!0,console.log("加载资源错误数据...");try{const s=await z(a.appId,a.startTime,a.endTime,10);console.log("资源错误数据:",s),n.value=s}catch(s){console.error("加载资源错误数据失败:",s),L.error("加载资源错误数据失败")}finally{t.value.resourceErrors=!1}},p=()=>{v(),u(),c()},_=()=>{console.log("时间范围变化:",a.timeRange),console.log("新的开始时间:",a.startTime),console.log("新的结束时间:",a.endTime),p()},k=s=>{console.log("指标类型变化:",s),f.value=s,u()};return H(()=>a.appId,(s,C)=>{s!==C&&(console.log("应用ID变化:",s),p())}),O(()=>{console.log("Performance页面已挂载"),p()}),(s,C)=>{const l=i("el-row"),w=i("el-col");return d(),g("div",ge,[C[0]||(C[0]=r("div",{class:"performance-header"},[r("h2",{class:"page-title"},"性能概览"),r("p",{class:"page-description"},"查看和分析应用的核心性能指标")],-1)),e(l,{class:"time-filter"},{default:o(()=>[e(j,{onChange:_})]),_:1}),e(l,{gutter:20,class:"metric-cards"},{default:o(()=>[e(w,{xs:24,sm:12},{default:o(()=>[e(M,{title:"LCP (最大内容绘制)","avg-value":m.value.lcp.avg,"p75-value":m.value.lcp.p75,icon:"Timer",color:"#E6A23C",loading:t.value.performance,threshold:{good:2500,needsImprovement:4e3}},null,8,["avg-value","p75-value","loading"])]),_:1}),e(w,{xs:24,sm:12},{default:o(()=>[e(M,{title:"FCP (首次内容绘制)","avg-value":m.value.fcp.avg,"p75-value":m.value.fcp.p75,icon:"PictureFilled",color:"#409EFF",loading:t.value.performance,threshold:{good:1e3,needsImprovement:2500}},null,8,["avg-value","p75-value","loading"])]),_:1})]),_:1}),e(l,{gutter:20,class:"data-lists"},{default:o(()=>[e(w,{xs:24,lg:12},{default:o(()=>[e(re,{data:y.value,loading:t.value.slowPages,metric:f.value,"onUpdate:metric":k},null,8,["data","loading","metric"])]),_:1}),e(w,{xs:24,lg:12},{default:o(()=>[e(_e,{data:n.value,loading:t.value.resourceErrors},null,8,["data","loading"])]),_:1})]),_:1})])}}}),Te=D(fe,[["__scopeId","data-v-89ea9f36"]]);export{Te as default};
